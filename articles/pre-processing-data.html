<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>pre-processing-data â€¢ buccaneer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="pre-processing-data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">buccaneer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/assemblage-time-series.html">Building time series based on species coexistence</a></li>
    <li><a class="dropdown-item" href="../articles/pre-processing-data.html">pre-processing-data</a></li>
    <li><a class="dropdown-item" href="../articles/time-series-metrics.html">Time series metrics</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>pre-processing-data</h1>
            
      

      <div class="d-none name"><code>pre-processing-data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gabrielnakamura.github.io/Buccaneer/">buccaneer</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>In this tutorial I will present how data on longevity and fossil
occurrence can be used to investigate the imprints of species
competition in different levels. This will be done with the help of the
new R package <code>Buccaneer</code></p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We will use the data from <a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2024.0473" class="external-link">Faurby
et al (2024)</a> to demonstrate how the new Buccaneer R package can be
used in processing and data analysis.</p>
<p>This data contains information on fossil data of all extant and
extinct species of mammalian carnivores and related extinct groups
(Carnivoramorpha, Hyaenodonta and Oxyaenidae)retrieved from Paleobiology
Database and New and Old Worlds database.</p>
</div>
<div class="section level2">
<h2 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">df.faurby</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"data_faurby.csv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span> <span class="co"># dataset from https://royalsocietypublishing.org/doi/10.1098/rspb.2024.0473</span></span>
<span><span class="va">df.body.mass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"Inferred_Size_Carnivoramorpha.csv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span> <span class="co"># dataset from https://royalsocietypublishing.org/doi/10.1098/rspb.2024.0473</span></span>
<span><span class="va">taxonomic_placement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"taxonomic_placement.csv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="general-cleaning-and-processing">General cleaning and processing<a class="anchor" aria-label="anchor" href="#general-cleaning-and-processing"></a>
</h2>
<p>Here I will filter the original data keeping only Carnivora species
from suborders Caniformia and Feliformia and only records from
Eurasia</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taxonomic_placement2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">taxonomic_placement</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Suborder</span> <span class="op">==</span> <span class="st">"Caniformia"</span> <span class="op">|</span> <span class="va">Suborder</span> <span class="op">==</span> <span class="st">"Feliformia"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># adding a new column with genus and species to taxonomic placement and occurrence records</span></span>
<span><span class="va">taxonomic_placement2</span><span class="op">$</span><span class="va">genus.species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">taxonomic_placement2</span><span class="op">$</span><span class="va">Genus</span>, <span class="va">taxonomic_placement2</span><span class="op">$</span><span class="va">Species</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">df.faurby</span><span class="op">$</span><span class="va">genus.species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">df.faurby</span><span class="op">$</span><span class="va">Genus</span>, <span class="va">df.faurby</span><span class="op">$</span><span class="va">Species</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df.faurby2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">taxonomic_placement2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">df.faurby</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>genus.species <span class="op">=</span> <span class="st">"genus.species"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">Family.y</span>, <span class="op">-</span><span class="va">Genus.y</span>, <span class="op">-</span><span class="va">Species.y</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">rename</span><span class="op">(</span>Family <span class="op">=</span> <span class="va">Family.x</span>, Genus <span class="op">=</span> <span class="va">Genus.x</span>, Species <span class="op">=</span> <span class="va">Species.x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># keeping only Europe and NA</span></span>
<span><span class="va">df.faurby3</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">df.faurby2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Continent</span> <span class="op">==</span> <span class="st">"Europe"</span> <span class="op">|</span> <span class="va">Continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df.faurby3</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">df.faurby2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span></span></code></pre></div>
<p>Keeping the site ID from PBDB. I will use NOW ID only when PBDB is
absent</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df.faurby4</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">df.faurby3</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">PBDB_ID</span><span class="op">)</span>, <span class="va">NOW_ID</span>, <span class="va">PBDB_ID</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Processing data on body mass by calculating mean value for each
species</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_body_mass</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">df.body.mass</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Genus</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Size_Est</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="processing-and-flagging-data-with-buccaneer">Processing and flagging data with <code>Buccaneer</code><a class="anchor" aria-label="anchor" href="#processing-and-flagging-data-with-buccaneer"></a>
</h2>
<p>I will use the function <code>clean_occ_fossil</code> to make simple
data cleaning, processing and flagging the occurrence records. In this
example I will remove any record with NA in any of the columns and flag
records with the maximum and minimum age range greater than 5 myr,
calculate midpoint age, time of origination (TS) and time of extinction
(TE)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_occ_faurby</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/clean_occ_fossil.html">clean_occ_fossil</a></span><span class="op">(</span>df.occ.fossil <span class="op">=</span> <span class="va">df.faurby4</span>, </span>
<span>                 method.ages <span class="op">=</span> <span class="st">"midpoint"</span>,</span>
<span>                 thresh.age.range <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                 species <span class="op">=</span> <span class="st">"Genus"</span>,</span>
<span>                 Max.age <span class="op">=</span> <span class="st">"Maximum_Age"</span>,</span>
<span>                 Min.age <span class="op">=</span> <span class="st">"Minimum_Age"</span>, </span>
<span>                 site <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>                 lat <span class="op">=</span> <span class="st">"Latitude"</span>,</span>
<span>                 lng <span class="op">=</span> <span class="st">"Longitude"</span>,</span>
<span>                 remove.sub.species <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 comp.TS.TE <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                 group <span class="op">=</span> <span class="st">"Suborder"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_occ_faurby</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">df_occ_faurby</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">!=</span> <span class="st">"Delete"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filtering TS and TE per species</span></span>
<span></span>
<span><span class="va">df_TS_TE_faurby</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">df_occ_faurby</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">distinct</span><span class="op">(</span><span class="va">species</span>, .keep_all <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># joining TS and TE with body mass</span></span>
<span></span>
<span><span class="va">df_TS_TE_mass</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">df_body_mass</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">df_TS_TE_faurby</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Genus <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">rename</span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Genus"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TS</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">TE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">site</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating time intervals (bins)</span></span>
<span></span>
<span><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df_occ_faurby</span><span class="op">$</span><span class="va">Max.age</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df_occ_faurby</span><span class="op">$</span><span class="va">Min.age</span><span class="op">)</span>, by <span class="op">=</span> <span class="op">-</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
