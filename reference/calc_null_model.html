<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Null Model for Trait Distances with Fixed Site Richness — calc_null_model • buccaneer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Null Model for Trait Distances with Fixed Site Richness — calc_null_model"><meta name="description" content="This function generates null distributions of trait distances by randomly
permuting species occurrences across sites while maintaining the observed
number of species per site (fixed row sums) and total occurrences per species
(fixed column sums). It computes mean trait distances for each permutation
to create null expectations for comparing against observed patterns."><meta property="og:description" content="This function generates null distributions of trait distances by randomly
permuting species occurrences across sites while maintaining the observed
number of species per site (fixed row sums) and total occurrences per species
(fixed column sums). It computes mean trait distances for each permutation
to create null expectations for comparing against observed patterns."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">buccaneer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/assemblage-time-series.html">Building time series based on species coexistence</a></li>
    <li><a class="dropdown-item" href="../articles/pre-processing-data.html">pre-processing-data</a></li>
    <li><a class="dropdown-item" href="../articles/time-series-metrics.html">Time series metrics</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Null Model for Trait Distances with Fixed Site Richness</h1>

      <div class="d-none name"><code>calc_null_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function generates null distributions of trait distances by randomly
permuting species occurrences across sites while maintaining the observed
number of species per site (fixed row sums) and total occurrences per species
(fixed column sums). It computes mean trait distances for each permutation
to create null expectations for comparing against observed patterns.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_null_model</span><span class="op">(</span></span>
<span>  <span class="va">list_occurrence</span>,</span>
<span>  <span class="va">dist_matrix_trait</span>,</span>
<span>  <span class="va">nearest.taxon</span>,</span>
<span>  nperm <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-list-occurrence">list_occurrence<a class="anchor" aria-label="anchor" href="#arg-list-occurrence"></a></dt>
<dd><p>A list where each element represents a time slice and
contains a data frame of species occurrences across sites or assemblages.
Each data frame should have sites as rows and species as columns (plus
one column for site identifiers). Presence is indicated by 1, absence by 0.</p></dd>


<dt id="arg-dist-matrix-trait">dist_matrix_trait<a class="anchor" aria-label="anchor" href="#arg-dist-matrix-trait"></a></dt>
<dd><p>A distance matrix (class <code>matrix</code> or <code>dist</code>)
containing pairwise trait distances between species. Row and column names
must match species names in <code>list_occurrence</code>.</p></dd>


<dt id="arg-nearest-taxon">nearest.taxon<a class="anchor" aria-label="anchor" href="#arg-nearest-taxon"></a></dt>
<dd><p>Numeric or character. The number of nearest neighbors to
consider when calculating mean distances. Use a numeric value (e.g., <code>1</code>)
for mean nearest neighbor distance (MNND), or <code>"all"</code> for mean pairwise
distance (MPD).</p></dd>


<dt id="arg-nperm">nperm<a class="anchor" aria-label="anchor" href="#arg-nperm"></a></dt>
<dd><p>Integer. The number of permutations to generate for the null model.
Default is 1000. Higher values provide more robust null distributions but
increase computation time.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A matrix with <code>nperm</code> rows and columns equal to the length of
<code>list_occurrence</code>. Each row represents one permutation, and each column
represents one time slice. Cell values contain mean trait distances calculated
from the randomized occurrence data.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps for each time slice:</p><ol><li><p>Generates <code>nperm</code> random permutations of the occurrence matrix
using <code>vegan::permatfull()</code> with fixed row and column margins</p></li>
<li><p>For each permutation, creates a species co-occurrence matrix</p></li>
<li><p>Filters the trait distance matrix to include only co-occurring species</p></li>
<li><p>Calculates mean distances based on <code>nearest.taxon</code>:</p><ul><li><p>If numeric: computes mean of the <code>nearest.taxon</code> nearest neighbors</p></li>
<li><p>If "all": computes mean pairwise distance (MPD) among all co-occurring species</p></li>
</ul></li>
</ol><p>The null model maintains:</p><ul><li><p>Species richness at each site (row sums)</p></li>
<li><p>Total number of occurrences for each species (column sums)</p></li>
<li><p>Presence/absence structure (binary data)</p></li>
</ul><p>This approach tests whether observed trait distances deviate from expectations
under random community assembly constrained by species prevalence and site richness.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Create example occurrence data for two time slices</span></span></span>
<span class="r-in"><span><span class="va">occ_slice1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site1"</span>, <span class="st">"site2"</span>, <span class="st">"site3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sp1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sp2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sp3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">occ_slice2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site1"</span>, <span class="st">"site2"</span>, <span class="st">"site3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sp1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sp2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sp4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">list_occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">occ_slice1</span>, <span class="va">occ_slice2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create trait distance matrix</span></span></span>
<span class="r-in"><span><span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="fl">3.1</span>, <span class="fl">4.0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp2"</span>, <span class="st">"sp3"</span>, <span class="st">"sp4"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dist_trait</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate null model with 100 permutations for MNND</span></span></span>
<span class="r-in"><span><span class="va">null_results_mnnd</span> <span class="op">&lt;-</span> <span class="fu">calc_null_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>  list_occurrence <span class="op">=</span> <span class="va">list_occ</span>,</span></span>
<span class="r-in"><span>  dist_matrix_trait <span class="op">=</span> <span class="va">dist_trait</span>,</span></span>
<span class="r-in"><span>  nearest.taxon <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  nperm <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate null model for MPD</span></span></span>
<span class="r-in"><span><span class="va">null_results_mpd</span> <span class="op">&lt;-</span> <span class="fu">calc_null_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>  list_occurrence <span class="op">=</span> <span class="va">list_occ</span>,</span></span>
<span class="r-in"><span>  dist_matrix_trait <span class="op">=</span> <span class="va">dist_trait</span>,</span></span>
<span class="r-in"><span>  nearest.taxon <span class="op">=</span> <span class="st">"all"</span>,</span></span>
<span class="r-in"><span>  nperm <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate observed values (hypothetical)</span></span></span>
<span class="r-in"><span><span class="va">observed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.3</span>, <span class="fl">2.7</span><span class="op">)</span>  <span class="co"># for two time slices</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate standardized effect sizes (SES)</span></span></span>
<span class="r-in"><span><span class="va">ses</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">observed_values</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">null_results_mpd</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">null_results_mpd</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test significance (two-tailed)</span></span></span>
<span class="r-in"><span><span class="va">p_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">null_results_mpd</span> <span class="op">-</span></span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">observed_values</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">null_results_mpd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span></span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">observed_values</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">null_results_mpd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

