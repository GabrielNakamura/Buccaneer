<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Species Richness Across Time Slices and Grid Cells — Assemblage_regional_richness • Buccaneer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Species Richness Across Time Slices and Grid Cells — Assemblage_regional_richness"><meta name="description" content="This function computes species richness for fossil assemblages across spatial
grid cells and temporal bins. It divides geographic space into a regular grid
and temporal ranges into discrete time slices, then calculates the number of
species present in each grid cell during each time slice based on occurrence
records and species longevities."><meta property="og:description" content="This function computes species richness for fossil assemblages across spatial
grid cells and temporal bins. It divides geographic space into a regular grid
and temporal ranges into discrete time slices, then calculates the number of
species present in each grid cell during each time slice based on occurrence
records and species longevities."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Buccaneer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/assemblage-time-series.html">Building time series based on species coexistence</a></li>
    <li><a class="dropdown-item" href="../articles/pre-processing-data.html">pre-processing-data</a></li>
    <li><a class="dropdown-item" href="../articles/time-series-metrics.html">Time series metrics</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Species Richness Across Time Slices and Grid Cells</h1>

      <div class="d-none name"><code>Assemblage_regional_richness.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function computes species richness for fossil assemblages across spatial
grid cells and temporal bins. It divides geographic space into a regular grid
and temporal ranges into discrete time slices, then calculates the number of
species present in each grid cell during each time slice based on occurrence
records and species longevities.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Assemblage_regional_richness</span><span class="op">(</span></span>
<span>  <span class="va">df.TS.TE</span>,</span>
<span>  <span class="va">df.occ</span>,</span>
<span>  <span class="va">time.slice</span>,</span>
<span>  <span class="va">grid.size</span>,</span>
<span>  round.digits <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  TS <span class="op">=</span> <span class="st">"TS"</span>,</span>
<span>  TE <span class="op">=</span> <span class="st">"TE"</span>,</span>
<span>  Max.age <span class="op">=</span> <span class="st">"Max.age"</span>,</span>
<span>  Min.age <span class="op">=</span> <span class="st">"Min.age"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"lng"</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">4326</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df-ts-te">df.TS.TE<a class="anchor" aria-label="anchor" href="#arg-df-ts-te"></a></dt>
<dd><p>A data frame containing species temporal data with at least
three columns: species names, origination times (TS), and extinction
times (TE).</p></dd>


<dt id="arg-df-occ">df.occ<a class="anchor" aria-label="anchor" href="#arg-df-occ"></a></dt>
<dd><p>A data frame containing fossil occurrence records with at least
five columns: species names, minimum age, maximum age, latitude, and
longitude. Each row represents a single occurrence record at a specific
location.</p></dd>


<dt id="arg-time-slice">time.slice<a class="anchor" aria-label="anchor" href="#arg-time-slice"></a></dt>
<dd><p>Numeric. The time interval (in the same units as TS and TE)
between consecutive time slices for temporal binning.</p></dd>


<dt id="arg-grid-size">grid.size<a class="anchor" aria-label="anchor" href="#arg-grid-size"></a></dt>
<dd><p>Numeric. The size of grid cells in degrees for spatial binning.
For example, <code>grid.size = 5</code> creates 5° × 5° grid cells.</p></dd>


<dt id="arg-round-digits">round.digits<a class="anchor" aria-label="anchor" href="#arg-round-digits"></a></dt>
<dd><p>Integer. The number of decimal places to round time slice
values. Default is 1. This affects temporal binning precision.</p></dd>


<dt id="arg-species">species<a class="anchor" aria-label="anchor" href="#arg-species"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> and
<code>df.occ</code> containing species identifiers. Default is "species".</p></dd>


<dt id="arg-ts">TS<a class="anchor" aria-label="anchor" href="#arg-ts"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> containing
origination (start) times for each species. Default is "TS".</p></dd>


<dt id="arg-te">TE<a class="anchor" aria-label="anchor" href="#arg-te"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> containing
extinction (end) times for each species. Default is "TE".</p></dd>


<dt id="arg-max-age">Max.age<a class="anchor" aria-label="anchor" href="#arg-max-age"></a></dt>
<dd><p>Character. The name of the column in <code>df.occ</code> containing
the maximum (oldest) age estimate for each occurrence record. Default is "Max.age".</p></dd>


<dt id="arg-min-age">Min.age<a class="anchor" aria-label="anchor" href="#arg-min-age"></a></dt>
<dd><p>Character. The name of the column in <code>df.occ</code> containing
the minimum (youngest) age estimate for each occurrence record. Default is "Min.age".</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>Character. The name of the column in <code>df.occ</code> containing
latitude coordinates for occurrence records. Default is "lat".</p></dd>


<dt id="arg-lon">lon<a class="anchor" aria-label="anchor" href="#arg-lon"></a></dt>
<dd><p>Character. The name of the column in <code>df.occ</code> containing
longitude coordinates for occurrence records. Default is "lng".</p></dd>


<dt id="arg-crs">crs<a class="anchor" aria-label="anchor" href="#arg-crs"></a></dt>
<dd><p>Numeric or character. The coordinate reference system (CRS) code
for spatial data. Default is 4326 (WGS84 geographic coordinates).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing two elements:</p>
<dl><dt>grid_mean_age</dt>
<dd><p>An sf object with grid cell geometries and temporal
summaries. Contains columns:</p><ul><li><p><code>grid_id</code>: Unique identifier for each grid cell</p></li>
<li><p><code>mean.age.grid</code>: Mean age of all occurrences in the grid cell</p></li>
<li><p><code>var.age.grid</code>: Variance of ages in the grid cell</p></li>
<li><p><code>geometry</code>: Spatial geometry of the grid cell</p></li>
</ul></dd>

<dt>time_series_rich</dt>
<dd><p>A data frame with richness metric for each grid
cell and time slice. Contains columns:</p><ul><li><p><code>grid_id</code>: Grid cell identifier</p></li>
<li><p><code>mean.age.grid</code>: Mean age of occurrences in the grid cell</p></li>
<li><p><code>var.age.grid</code>: Variance of ages in the grid cell</p></li>
<li><p><code>time.slice</code>: Time slice identifier</p></li>
<li><p><code>rich.by.grid</code>: Species richness in the grid cell during the time slice</p></li>
<li><p><code>mean.rich.by.grid.slice</code>: Mean richness across all grid cells in the time slice</p></li>
<li><p><code>geometry</code>: Spatial geometry of the grid cell</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps:</p><ol><li><p>Creates a spatial grid covering the extent of occurrence records</p></li>
<li><p>Assigns each occurrence to a grid cell based on coordinates</p></li>
<li><p>Calculates temporal statistics (mean and variance of ages) for each grid cell</p></li>
<li><p>Divides the temporal range into discrete time slices</p></li>
<li><p>For each time slice, identifies species present based on longevities</p></li>
<li><p>Counts species richness in each grid cell for each time slice</p></li>
<li><p>Computes mean richness across grid cells within each time slice</p></li>
</ol><p>Missing or invalid coordinates (NA values) are automatically removed before
spatial analysis. Grid cells without occurrences in a time slice will not
appear in the results for that time slice.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Create example data</span></span></span>
<span class="r-in"><span><span class="va">df_temporal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp2"</span>, <span class="st">"sp3"</span>, <span class="st">"sp4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  TS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">95</span>, <span class="fl">90</span>, <span class="fl">85</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  TE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">45</span>, <span class="fl">40</span>, <span class="fl">35</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df_occurrences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp1"</span>, <span class="st">"sp2"</span>, <span class="st">"sp3"</span>, <span class="st">"sp4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Max.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">95</span>, <span class="fl">95</span>, <span class="fl">90</span>, <span class="fl">85</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Min.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">85</span>, <span class="fl">85</span>, <span class="fl">80</span>, <span class="fl">75</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10.5</span>, <span class="fl">15.2</span>, <span class="fl">20.1</span>, <span class="fl">25.3</span>, <span class="fl">30.0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50.0</span>, <span class="op">-</span><span class="fl">55.5</span>, <span class="op">-</span><span class="fl">60.2</span>, <span class="op">-</span><span class="fl">65.0</span>, <span class="op">-</span><span class="fl">70.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate regional richness with 10 Ma time slices and 5° grid cells</span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">Assemblage_regional_richness</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df.TS.TE <span class="op">=</span> <span class="va">df_temporal</span>,</span></span>
<span class="r-in"><span>  df.occ <span class="op">=</span> <span class="va">df_occurrences</span>,</span></span>
<span class="r-in"><span>  time.slice <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  grid.size <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access grid-level summaries</span></span></span>
<span class="r-in"><span><span class="va">grid_summary</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">grid_mean_age</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access time series of richness</span></span></span>
<span class="r-in"><span><span class="va">richness_timeseries</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">time_series_rich</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot richness for a specific time slice</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">slice_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">time_series_rich</span>, <span class="va">time.slice</span> <span class="op">==</span> <span class="fl">90</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">slice_data</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">rich.by.grid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

