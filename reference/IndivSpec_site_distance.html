<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Mean Trait Distance for Individual Species Co-occurring at Local Sites — IndivSpec_site_distance • buccaneer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Mean Trait Distance for Individual Species Co-occurring at Local Sites — IndivSpec_site_distance"><meta name="description" content="This function computes mean pairwise trait distances between species that
co-occur at specific fossil sites across different time slices. For each
species present at a site, it calculates the mean distance to its co-occurring
species, supporting both mean nearest neighbor distance (MNND) and mean
pairwise distance (MPD) metrics. The function can perform comparisons between
groups or within a single group."><meta property="og:description" content="This function computes mean pairwise trait distances between species that
co-occur at specific fossil sites across different time slices. For each
species present at a site, it calculates the mean distance to its co-occurring
species, supporting both mean nearest neighbor distance (MNND) and mean
pairwise distance (MPD) metrics. The function can perform comparisons between
groups or within a single group."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">buccaneer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/assemblage-time-series.html">Building time series based on species coexistence</a></li>
    <li><a class="dropdown-item" href="../articles/pre-processing-data.html">pre-processing-data</a></li>
    <li><a class="dropdown-item" href="../articles/time-series-metrics.html">Time series metrics</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Mean Trait Distance for Individual Species Co-occurring at Local Sites</h1>

      <div class="d-none name"><code>IndivSpec_site_distance.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function computes mean pairwise trait distances between species that
co-occur at specific fossil sites across different time slices. For each
species present at a site, it calculates the mean distance to its co-occurring
species, supporting both mean nearest neighbor distance (MNND) and mean
pairwise distance (MPD) metrics. The function can perform comparisons between
groups or within a single group.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">IndivSpec_site_distance</span><span class="op">(</span></span>
<span>  <span class="va">df.TS.TE</span>,</span>
<span>  <span class="va">df.occ</span>,</span>
<span>  <span class="va">time.slice</span>,</span>
<span>  <span class="va">dist.trait</span>,</span>
<span>  <span class="va">nearest.taxon</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group.focal.compare <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type.comparison <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trait <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  round.digits <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  TS <span class="op">=</span> <span class="st">"TS"</span>,</span>
<span>  TE <span class="op">=</span> <span class="st">"TE"</span>,</span>
<span>  Max.age <span class="op">=</span> <span class="st">"Max.age"</span>,</span>
<span>  Min.age <span class="op">=</span> <span class="st">"Min.age"</span>,</span>
<span>  site <span class="op">=</span> <span class="st">"site"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df-ts-te">df.TS.TE<a class="anchor" aria-label="anchor" href="#arg-df-ts-te"></a></dt>
<dd><p>A data frame containing species temporal and, optionally,
trait data with at least three columns: species names, origination times (TS), extinction
times (TE), and, optionally, trait values.
Additional columns may include group assignments.</p></dd>


<dt id="arg-df-occ">df.occ<a class="anchor" aria-label="anchor" href="#arg-df-occ"></a></dt>
<dd><p>A data frame containing fossil occurrence records with at least
four columns: species names, minimum age, maximum age, and site location ID.
Each row represents a single occurrence record at a specific site.</p></dd>


<dt id="arg-time-slice">time.slice<a class="anchor" aria-label="anchor" href="#arg-time-slice"></a></dt>
<dd><p>Numeric. The time interval (in the same units as TS and TE)
between consecutive time slices for binning occurrences.</p></dd>


<dt id="arg-dist-trait">dist.trait<a class="anchor" aria-label="anchor" href="#arg-dist-trait"></a></dt>
<dd><p>A distance matrix object (class <code>dist</code> or <code>matrix</code>)
containing pairwise trait distances between species. Row and column names
must match species names in <code>df.TS.TE</code>. If NULL, distances will be
computed from the trait column in <code>df.TS.TE</code> using Euclidean distance.</p></dd>


<dt id="arg-nearest-taxon">nearest.taxon<a class="anchor" aria-label="anchor" href="#arg-nearest-taxon"></a></dt>
<dd><p>Numeric or character. The number of nearest neighbors to
consider when calculating mean distances. Use <code>1</code> for mean nearest
neighbor distance (MNND), or <code>"all"</code> for mean pairwise distance (MPD).</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> containing
group assignments for species (e.g., clade, family). Required if using
<code>group.focal.compare</code>. Default is NULL.</p></dd>


<dt id="arg-group-focal-compare">group.focal.compare<a class="anchor" aria-label="anchor" href="#arg-group-focal-compare"></a></dt>
<dd><p>Character vector of length 2. The first element
specifies the focal group and the second specifies the comparison group.
If NULL (default), distances are calculated across all species regardless
of group membership.</p></dd>


<dt id="arg-type-comparison">type.comparison<a class="anchor" aria-label="anchor" href="#arg-type-comparison"></a></dt>
<dd><p>Character. Specifies the type of distance comparison:</p><ul><li><p><code>"between"</code>: Calculate distances only between species from
the focal and comparison groups.</p></li>
<li><p><code>"within"</code>: Calculate distances only among species within
the focal group.</p></li>
<li><p>NULL (default): Calculate distances among all species together.</p></li>
</ul></dd>


<dt id="arg-trait">trait<a class="anchor" aria-label="anchor" href="#arg-trait"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> containing
trait values. If NULL (default), <code>dist.trait</code> must be provided.</p></dd>


<dt id="arg-round-digits">round.digits<a class="anchor" aria-label="anchor" href="#arg-round-digits"></a></dt>
<dd><p>Integer. The number of decimal places to round time slice
values. Default is 1. This affects temporal binning precision.</p></dd>


<dt id="arg-species">species<a class="anchor" aria-label="anchor" href="#arg-species"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> and
<code>df.occ</code> containing species identifiers. Default is "species".</p></dd>


<dt id="arg-ts">TS<a class="anchor" aria-label="anchor" href="#arg-ts"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> containing
origination times for each species. Default is "TS".</p></dd>


<dt id="arg-te">TE<a class="anchor" aria-label="anchor" href="#arg-te"></a></dt>
<dd><p>Character. The name of the column in <code>df.TS.TE</code> containing
extinction times for each species. Default is "TE".</p></dd>


<dt id="arg-max-age">Max.age<a class="anchor" aria-label="anchor" href="#arg-max-age"></a></dt>
<dd><p>Character. The name of the column in <code>df.occ</code> containing
the maximum time estimate for each occurrence record. Default is "Max.age".</p></dd>


<dt id="arg-min-age">Min.age<a class="anchor" aria-label="anchor" href="#arg-min-age"></a></dt>
<dd><p>Character. The name of the column in <code>df.occ</code> containing
the minimum age estimate for each occurrence record. Default is "Min.age".</p></dd>


<dt id="arg-site">site<a class="anchor" aria-label="anchor" href="#arg-site"></a></dt>
<dd><p>Character. The name of the column in <code>df.occ</code> containing
site location identifiers. Default is "site".</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with four columns:</p>
<dl><dt>species</dt>
<dd><p>Character. The name of each species.</p></dd>

<dt>time.slice</dt>
<dd><p>Numeric. The time slice identifier.</p></dd>

<dt>mean_dist_to_cooccur</dt>
<dd><p>Numeric. The mean trait distance from each
species to its co-occurring species at each site and time slice.
Returns 0 for singleton species (species with no co-occurring taxa),
and NA when data is insufficient.</p></dd>

<dt>is_singleton</dt>
<dd><p>Logical. TRUE if the species occurred alone at the
site during that time slice, FALSE otherwise.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps:</p><ol><li><p>Divides the temporal range into discrete time slices based on <code>time.slice</code></p></li>
<li><p>Determines which species co-occur at each site within each time slice</p></li>
<li><p>For each species at each site, calculates mean trait distances to co-occurring species</p></li>
<li><p>Optionally filters comparisons by group membership (focal vs. comparison groups)</p></li>
</ol><p>Species-level results include:</p><ul><li><p><strong>Singleton species</strong>: Species occurring alone at a site receive a
<code>mean_dist_to_cooccur</code> value of 0 and <code>is_singleton = TRUE</code></p></li>
<li><p><strong>Missing data</strong>: Time slices or sites with insufficient data return NA</p></li>
<li><p><strong>Group filtering</strong>: When using <code>group.focal.compare</code>, only
distances between specified groups are computed</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create example fossil data</span></span></span>
<span class="r-in"><span><span class="va">df_longevities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp2"</span>, <span class="st">"sp3"</span>, <span class="st">"sp4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  TS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">98</span>, <span class="fl">98</span>, <span class="fl">85</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  TE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">45</span>, <span class="fl">40</span>, <span class="fl">35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2.5</span>, <span class="fl">3.1</span>, <span class="fl">4.0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df_occurrences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp1"</span>, <span class="st">"sp2"</span>, <span class="st">"sp3"</span>, <span class="st">"sp4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Max.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">95</span>, <span class="fl">95</span>, <span class="fl">95</span>, <span class="fl">85</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Min.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">65</span>, <span class="fl">50</span>, <span class="fl">80</span>, <span class="fl">80</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site1"</span>, <span class="st">"site2"</span>, <span class="st">"site2"</span>, <span class="st">"site1"</span>, <span class="st">"site2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate MPD for all species at each site</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">IndivSpec_site_distance</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df.TS.TE <span class="op">=</span> <span class="va">df_longevities</span>,</span></span>
<span class="r-in"><span>  df.occ <span class="op">=</span> <span class="va">df_occurrences</span>,</span></span>
<span class="r-in"><span>  trait <span class="op">=</span> <span class="st">"trait"</span>,</span></span>
<span class="r-in"><span>  time.slice <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  dist.trait <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>  nearest.taxon <span class="op">=</span> <span class="st">"all"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in loadNamespace(x):</span> there is no package called ‘tidyr’</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate MNND between groups at each site</span></span></span>
<span class="r-in"><span><span class="va">result_between</span> <span class="op">&lt;-</span> <span class="fu">IndivSpec_site_distance</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df.TS.TE <span class="op">=</span> <span class="va">df_longevities</span>,</span></span>
<span class="r-in"><span>  df.occ <span class="op">=</span> <span class="va">df_occurrences</span>,</span></span>
<span class="r-in"><span>  time.slice <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  trait <span class="op">=</span> <span class="st">"trait"</span>,</span></span>
<span class="r-in"><span>  dist.trait <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>  nearest.taxon <span class="op">=</span> <span class="st">"all"</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="st">"group"</span>,</span></span>
<span class="r-in"><span>  group.focal.compare <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  type.comparison <span class="op">=</span> <span class="st">"between"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in loadNamespace(x):</span> there is no package called ‘tidyr’</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">result_within</span> <span class="op">&lt;-</span> <span class="fu">IndivSpec_site_distance</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df.TS.TE <span class="op">=</span> <span class="va">df_longevities</span>,</span></span>
<span class="r-in"><span>  df.occ <span class="op">=</span> <span class="va">df_occurrences</span>,</span></span>
<span class="r-in"><span>  time.slice <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  trait <span class="op">=</span> <span class="st">"trait"</span>,</span></span>
<span class="r-in"><span>  dist.trait <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>  nearest.taxon <span class="op">=</span> <span class="st">"all"</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="st">"group"</span>,</span></span>
<span class="r-in"><span>  group.focal.compare <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  type.comparison <span class="op">=</span> <span class="st">"within"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in loadNamespace(x):</span> there is no package called ‘tidyr’</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

